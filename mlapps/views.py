from django.shortcuts import render
import pickle
import numpy as np
import pandas as pd
from sklearn.naive_bayes import MultinomialNB
from sklearn.linear_model import LogisticRegression
from sklearn.svm import SVC
from sklearn.preprocessing import LabelEncoder
import lightgbm as lgb

def entrance(request):
    return render(request, 'mlapps/entrance.html', {})


questions = {
        'ã‚ãªãŸã®æ€§åˆ¥ã¯ä½•ã§ã™ã‹ï¼Ÿ':['0. ç”·æ€§', '1. å¥³æ€§']
        ,'ã‚ãªãŸã¯æ–‡ç³»ã§ã™ã‹ï¼Ÿç†ç³»ã§ã™ã‹ï¼Ÿ':['0. æ–‡ç³»', '1. ç†ç³»']
        ,'ã‚ãªãŸã®å’æ¥­ã—ãŸé«˜æ ¡ã®å…¥å­¦å½“æ™‚ã®åå·®å€¤ã¯ãŠã‚ˆãã„ãã¤ã§ã—ãŸã‹ï¼Ÿ':['0. ~29', '1. 30~39', '2. 40~49', '3. 50~59', '4. 60~69', '5. 70~']
        ,'ã‚ãªãŸã¯é«˜æ ¡æ™‚ä»£ã«ä½•ã‹éƒ¨æ´»ã«åŠ å…¥ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ':['0. é‹å‹•éƒ¨', '1. æ–‡åŒ–éƒ¨', '2. ãã®ä»–(åŠ å…¥ã—ã¦ã„ãªã„å«ã‚€)']
        ,'ã‚ãªãŸã¯å¤§å­¦é€²å­¦ã¨ã„ã†é€²è·¯é¸æŠã«ã¤ã„ã¦ã€æ˜ç¢ºãªç›®çš„æ„è­˜ãŒã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ':['0. ã¯ã„', '1. ã„ã„ãˆ']
        ,'ã‚ãªãŸã¯ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ':['0. ã¯ã„', '1. ã„ã„ãˆ']
        ,'ã‚ãªãŸã¯å‘¨ã‚Šã¨åˆã‚ã›ã‚‹ã‚ˆã‚Šã‚‚è‡ªåˆ†ã®é“ã‚’çªãé€šã™æ–¹ã§ã™ã‹ï¼Ÿ':['0. ã¯ã„', '1. ã„ã„ãˆ']
        ,'ã‚ãªãŸã¯éŸ³æ¥½ã‚’è´ããªãŒã‚‰å‹‰å¼·ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ':['0. ã¯ã„', '1. ã„ã„ãˆ']
        ,'ã‚ãªãŸã¯å¡¾ãƒ»äºˆå‚™æ ¡(ã¾ãŸã¯ãã‚Œã«æº–ãšã‚‹ã‚µãƒ¼ãƒ“ã‚¹ç­‰)ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ':['0. ã¯ã„', '1. ã„ã„ãˆ']
        ,'ã‚ãªãŸã¯é’å­¦åˆæ ¼å¹´åº¦ã®å¤ã«ä¸€æ—¥å¹³å‡ã©ã®ç¨‹åº¦å‹‰å¼·ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ':['0. 0~2æ™‚é–“', '1. 2~4æ™‚é–“', '2. 4~6æ™‚é–“', '3. 6~8æ™‚é–“', '4. 8~10æ™‚é–“', '5. 10æ™‚é–“ä»¥ä¸Š']
        ,'ã‚ãªãŸã¯é’å­¦åˆæ ¼å¹´åº¦ã«ä¸€æ—¥å¹³å‡ã©ã®ç¨‹åº¦ç¡çœ ã‚’ã¨ã£ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ':['0. ~5æ™‚é–“', '1. 6~7æ™‚é–“', '2. 8~æ™‚é–“']
        ,'ã‚ãªãŸã¯å—é¨“æœŸã«ã‚¹ãƒãƒ›ã‚„ãƒ†ãƒ¬ãƒ“ç­‰ã®ä½¿ç”¨åˆ¶é™ã‚’ã‹ã‘ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ':['0. ã¯ã„', '1. ã„ã„ãˆ']
        ,'ã‚ãªãŸãŒä½¿ç”¨ã—ã¦ã„ãŸä»˜ç®‹ã®è‰²ã®æ•°ã¯ã„ãã¤ã§ã—ãŸã‹ï¼Ÿ':['0. 0è‰²(ä»˜ç®‹ã¯ä½¿ç”¨ã—ã¦ã„ãªã„)', '1. 1è‰²', '2. 2è‰²', '3. 3è‰²', '4. 4è‰²ä»¥ä¸Š']
        ,'ã‚ãªãŸãŒä½¿ç”¨ã—ã¦ã„ãŸãƒœãƒ¼ãƒ«ãƒšãƒ³(è›å…‰ãƒšãƒ³)ã®è‰²ã®æ•°ã¯ã„ãã¤ã§ã—ãŸã‹ï¼Ÿ':['0. 0è‰²(ãƒœãƒ¼ãƒ«ãƒšãƒ³ã¯ä½¿ç”¨ã—ã¦ã„ãªã„)', '1. 1è‰²', '2. 2è‰²', '3. 3è‰²', '4. 4è‰²ä»¥ä¸Š']
        ,'ç¬¬ä¸€å¿—æœ›å¤§å­¦ç¾¤ã¯ã©ã“ã§ã—ãŸã‹ï¼Ÿ':['0. æœ€é›£é–¢å›½å…¬ç«‹(æ±äº¬ä¸€å·¥)ãƒ»æ—©æ…¶', '1. é›£é–¢å›½å…¬ç«‹(é‡‘å²¡åƒåºƒç­‰)ãƒ»ä¸Šæ™ºç†ç§‘å¤§', '2. æº–é›£é–¢å›½å…¬ç«‹(5Sç­‰)ãƒ»MARCH', '3. æ¨™æº–å›½ç«‹(starsç­‰)ãƒ»æ—¥æ±é§’å°‚', '4. ãã®ä»–']
        ,'ã‚ãªãŸã¯é’å­¦ã‚’ç¬¬ä½•å¿—æœ›æ ¡ã¨ã—ã¦è¨­å®šã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ':['0. ç¬¬ä¸€å¿—æœ›æ ¡', '1. ç¬¬äºŒå¿—æœ›æ ¡', '2. ç¬¬ä¸‰å¿—æœ›æ ¡', '3. ãã®ä»–(ç¬¬å››å¿—æœ›æ ¡ä»¥ä¸‹)']
        ,'å¤ã«ä½•ã‚‰ã‹ã®æ¨¡è©¦ã‚’å—ã‘ã¾ã—ãŸã‹ï¼Ÿ':['0. æ²³åˆæ¨¡è©¦', '1. é§¿å°æ¨¡è©¦', '2. æ±é€²æ¨¡è©¦', '3. ä»£ã€…æœ¨æ¨¡è©¦', '4. é€²ç ”æ¨¡è©¦', '5. è¤‡æ•°å—é¨“ã—ãŸ', '6. ãã®ä»–(å—ã‘ã¦ã„ãªã„å«ã‚€)']
        ,'[æœ€é‡è¦]ãƒãƒˆã¯"è‰¯ã„"ã§ã™ã‹ï¼Ÿ':['0. ã¯ã„', '1. ã„ã„ãˆ', '810. ï½µï¾Šï½°ï¾„ğŸ¦']
    }
bayes_columns = ['ã‚ãªãŸã®æ€§åˆ¥ã¯ä½•ã§ã™ã‹ï¼Ÿ', 'ã‚ãªãŸã¯æ–‡ç³»ã§ã™ã‹ï¼Ÿç†ç³»ã§ã™ã‹ï¼Ÿ', 'ã‚ãªãŸã¯é«˜æ ¡æ™‚ä»£ã«ä½•ã‹éƒ¨æ´»ã«åŠ å…¥ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯å¤§å­¦é€²å­¦ã¨ã„ã†é€²è·¯é¸æŠã«ã¤ã„ã¦ã€æ˜ç¢ºãªç›®çš„æ„è­˜ãŒã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ', 'ã‚ãªãŸã¯å‘¨ã‚Šã¨åˆã‚ã›ã‚‹ã‚ˆã‚Šã‚‚è‡ªåˆ†ã®é“ã‚’çªãé€šã™æ–¹ã§ã™ã‹ï¼Ÿ', 'ã‚ãªãŸã¯éŸ³æ¥½ã‚’è´ããªãŒã‚‰å‹‰å¼·ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯å¡¾ãƒ»äºˆå‚™æ ¡(ã¾ãŸã¯ãã‚Œã«æº–ãšã‚‹ã‚µãƒ¼ãƒ“ã‚¹ç­‰)ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯é’å­¦åˆæ ¼å¹´åº¦ã«ä¸€æ—¥å¹³å‡ã©ã®ç¨‹åº¦ç¡çœ ã‚’ã¨ã£ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯å—é¨“æœŸã«ã‚¹ãƒãƒ›ã‚„ãƒ†ãƒ¬ãƒ“ç­‰ã®ä½¿ç”¨åˆ¶é™ã‚’ã‹ã‘ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ç¬¬ä¸€å¿—æœ›å¤§å­¦ç¾¤ã¯ã©ã“ã§ã—ãŸã‹ï¼Ÿ']
lr_columns = ['ã‚ãªãŸã¯å¤§å­¦é€²å­¦ã¨ã„ã†é€²è·¯é¸æŠã«ã¤ã„ã¦ã€æ˜ç¢ºãªç›®çš„æ„è­˜ãŒã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ', 'ã‚ãªãŸã¯å‘¨ã‚Šã¨åˆã‚ã›ã‚‹ã‚ˆã‚Šã‚‚è‡ªåˆ†ã®é“ã‚’çªãé€šã™æ–¹ã§ã™ã‹ï¼Ÿ', 'ã‚ãªãŸã¯éŸ³æ¥½ã‚’è´ããªãŒã‚‰å‹‰å¼·ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯å¡¾ãƒ»äºˆå‚™æ ¡(ã¾ãŸã¯ãã‚Œã«æº–ãšã‚‹ã‚µãƒ¼ãƒ“ã‚¹ç­‰)ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ã‚ãªãŸã¯å—é¨“æœŸã«ã‚¹ãƒãƒ›ã‚„ãƒ†ãƒ¬ãƒ“ç­‰ã®ä½¿ç”¨åˆ¶é™ã‚’ã‹ã‘ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ', 'ç¬¬ä¸€å¿—æœ›å¤§å­¦ç¾¤ã¯ã©ã“ã§ã—ãŸã‹ï¼Ÿ']
svm_columns = ['ã‚ãªãŸã¯ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ']
prediction = {
    0.:'A',
    1.:'B',
    2.:'C',
    3.:'D',
    4.:'E'
}
attention = 1
def delete_columns(df, columns):
    for column in df.columns:
        if column not in columns:
            del df[column]

def score(request):
    if request.method == 'GET':
        return render(request, 'mlapps/score.html', {'questions':questions})
    else:
        try:
            df_try = pd.DataFrame(index=['own'])
            for question in questions:
                df_try[question] = request.POST[question]

            df_bayes, df_lr, df_svm = df_try.copy(), df_try.copy(), df_try.copy()
            delete_columns(df_bayes, bayes_columns)
            delete_columns(df_lr, lr_columns)
            delete_columns(df_svm, svm_columns)

            with open('/home/aran/aran.pythonanywhere.com/Aoyamasai_models.pickle', mode='rb') as fp:
                model1, model2, model3 = pickle.load(fp)
            pred = int(np.round((model1.predict(df_bayes) + model2.predict(df_lr) + model3.predict(df_svm)) / 3))

            return render(request, 'mlapps/score.html',
            {
                'pred':prediction[pred],
            }
            )
        except:
            return render(request, 'mlapps/score.html', {'questions':questions, 'attention':attention})

def score_detail(request):
    return render(request, 'mlapps/score_detail.html', {})


with open('/home/aran/aran.pythonanywhere.com/Saddress.pickle', mode='rb') as fp:
    Saddress = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/Slayout.pickle', mode='rb') as fp:
    Slayout = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/Aaddress.pickle', mode='rb') as fp:
    Aaddress = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/Alayout.pickle', mode='rb') as fp:
    Alayout = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/Smodel_lgb_rent.pickle', mode='rb') as fp:
    Smodel_lgb_rent = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/Amodel_lgb_rent.pickle', mode='rb') as fp:
    Amodel_lgb_rent = pickle.load(fp)

questions_rent = {
    'ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®é¸æŠè‚¢ã‚ˆã‚Šã€ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„>':'ä½æ‰€',
    'ç®¡ç†å…±ç›Šè²»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„>':'ç®¡ç†å…±ç›Šè²»',
    'æ•·é‡‘(è³ƒæ–™ã®nãƒ¶æœˆåˆ†ã®n)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„>':'ç¤¼é‡‘',
    'ç¤¼é‡‘(è³ƒæ–™ã®nãƒ¶æœˆåˆ†ã®n)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„>':'æ•·é‡‘',
    'å°‚æœ‰é¢ç©(å˜ä½ï¼šm^2)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„>':'å°‚æœ‰é¢ç©',
    'ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®é¸æŠè‚¢ã‚ˆã‚Šã€é–“å–ã‚Šã‚’å…¥åŠ›ã—ã¦ãã ã•ã„>':'é–“å–ã‚Š',
    'ç¯‰å¹´æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„(æ–°ç¯‰ã®å ´åˆã¯0ã¨å…¥åŠ›ã—ã¦ãã ã•ã„)>':'ç¯‰å¹´æ•°'
}

def rent(request):
    if request.method == 'GET':
        return render(request, 'mlapps/rent.html', 
        {
            'questions_rent':questions_rent,
            'Aaddress':sorted(list(Aaddress.classes_)),
            'Alayout':sorted(list(Alayout.classes_)),
            'Saddress':sorted(list(Saddress.classes_)),
            'Slayout':sorted(list(Slayout.classes_))
        })
    else:
        try:
            which = int(request.POST['which'])
            df_try = pd.DataFrame(index=['own'])
            for question in questions_rent:
                df_try[questions_rent[question]] = request.POST[question]

            if which == 0:
                df_try['ä½æ‰€'] = Aaddress.transform(df_try['ä½æ‰€'])
                df_try['é–“å–ã‚Š'] = Alayout.transform(df_try['é–“å–ã‚Š'])
                df_try = df_try.astype(float)
                pred = Amodel_lgb_rent.predict(df_try)
            else:
                df_try['ä½æ‰€'] = Saddress.transform(df_try['ä½æ‰€'])
                df_try['é–“å–ã‚Š'] = Slayout.transform(df_try['é–“å–ã‚Š'])
                df_try = df_try.astype(float)
                pred = Smodel_lgb_rent.predict(df_try)

            return render(request, 'mlapps/rent.html', {'pred':'{0:.2f}'.format(float(pred))})
            
        except:
            return render(request, 'mlapps/rent.html', 
            {
                'questions_rent':questions_rent,
                'Aaddress':sorted(list(Aaddress.classes_)),
                'Alayout':sorted(list(Alayout.classes_)),
                'Saddress':sorted(list(Saddress.classes_)),
                'Slayout':sorted(list(Slayout.classes_)),
                'attention':attention
            })
        
def rent_detail(request):
    return render(request, 'mlapps/rent_detail.html', {})
    

with open('/home/aran/aran.pythonanywhere.com/LE_destination.pickle', mode='rb') as fp:
    LE_destination = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/LE_inn_num.pickle', mode='rb') as fp:
    LE_inn_num = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/LE_inn_type.pickle', mode='rb') as fp:
    LE_inn_type = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/LE_meal.pickle', mode='rb') as fp:
    LE_meal = pickle.load(fp)
with open('/home/aran/aran.pythonanywhere.com/model_lgb_travel.pickle', mode='rb') as fp:
    model_lgb_travel = pickle.load(fp)

questions_travel = {
    'æ—…è¡Œæ—¥æ•°ã‚’å³è¨˜ä¾‹ã®æ§˜ã«å…¥åŠ›ã—ã¦ãã ã•ã„>':'æ—…è¡Œæ—¥æ•°',
    'ç›®çš„åœ°ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ç›®çš„åœ°',
    'å®¿æ³Šæ–½è¨­ã®ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å®¿æ³Šæ–½è¨­ã‚¿ã‚¤ãƒ—',
    'å®¿æ³Šå…ˆã§ã®é£Ÿäº‹ã®å½¢å¼ã‚’é¸æŠã—ã¦ãã ã•ã„(ã€Œ-ã€ã¯é£Ÿäº‹ç„¡ã—)>':'é£Ÿäº‹',
    'å®¿æ³Šæ–½è¨­å—ã‘å…¥ã‚Œäººæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„>':'å®¿æ³Šæ–½è¨­å—ã‘å…¥ã‚Œäººæ•°',
    'æ¸©æ³‰ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'æ¸©æ³‰ã‚ã‚Š',
    'éœ²å¤©é¢¨å‘‚ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'éœ²å¤©é¢¨å‘‚ã‚ã‚Š',
    'å¤§æµ´å ´ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å¤§æµ´å ´ã‚ã‚Š',
    'ãƒ—ãƒ¼ãƒ«ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ“ãƒ¼ãƒã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ãƒ—ãƒ¼ãƒ«ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ“ãƒ¼ãƒã‚ã‚Š',
    'ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ãƒ“ãƒ¥ãƒ¼ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ãƒ“ãƒ¥ãƒ¼',
    'éœ²å¤©é¢¨å‘‚ä»˜ãå®¢å®¤ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'éœ²å¤©é¢¨å‘‚ä»˜ãå®¢å®¤',
    'å®¿æ³Šå…ˆãŒãƒªã‚¾ãƒ¼ãƒˆãƒ›ãƒ†ãƒ«ã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒªã‚¾ãƒ¼ãƒˆãƒ›ãƒ†ãƒ«',
    'ãƒ“ãƒ¼ãƒã®è¿‘ãã«å®¿æ³Šã™ã‚‹ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒ“ãƒ¼ãƒè¿‘ã',
    'ã‚²ãƒ¬ãƒ³ãƒ‡è¿‘ãã«å®¿æ³Šã™ã‚‹ã‹é¸æŠã—ã¦ãã ã•ã„>':'ã‚²ãƒ¬ãƒ³ãƒ‡è¿‘ã',
    'å®¿æ³Šå…ˆãŒãƒ“ã‚¸ãƒã‚¹ãƒ›ãƒ†ãƒ«ã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒ“ã‚¸ãƒã‚¹ãƒ›ãƒ†ãƒ«',
    'ãƒšãƒƒãƒˆOKã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒšãƒƒãƒˆOK',
    'ãƒ¬ã‚¤ãƒˆãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãŒå¯èƒ½ã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒ¬ã‚¤ãƒˆãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ',
    'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
    'å»¶æ³Šè¨­å®šã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å»¶æ³Šè¨­å®šã‚ã‚Š',
    'ä¸€åç”³è¾¼å¯èƒ½ã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'1åç”³è¾¼å¯',
    'ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ä»˜ãã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ä»˜ã',
    'ç¾å®¹ãƒ—ãƒ©ãƒ³ä»˜ãã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒªãƒ©ãƒƒã‚¯ã‚¹ãƒ»ç¾å®¹ä»˜',
    'ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ä»˜ãã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ä»˜',
    'ã‚³ãƒ³ã‚µãƒ¼ãƒˆãƒ»è¦³åŠ‡ä»˜ãã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ã‚³ãƒ³ã‚µãƒ¼ãƒˆãƒ»ã‚¹ãƒãƒ¼ãƒ„ãƒ»è¦³åŠ‡ä»˜',
    'å‚¬è¡Œä¿è¨¼æ—¥ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å‚¬è¡Œä¿è¨¼æ—¥ã‚ã‚Š',
    'ã‚°ãƒ«ãƒ¼ãƒ—ç‰¹å…¸ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚°ãƒ«ãƒ¼ãƒ—ç‰¹å…¸ã‚ã‚Š',
    'ã‚°ãƒ«ãƒ¡ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚°ãƒ«ãƒ¡ä»˜',
    'æ·»ä¹—å“¡ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'æ·»ä¹—å“¡ä»˜ã', 
    'ã‚¯ãƒ«ãƒ¼ã‚ºæ—…è¡Œãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚¯ãƒ«ãƒ¼ã‚ºæ—…è¡Œ', 
    'ãƒã‚¹ãƒ„ã‚¢ãƒ¼ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ãƒã‚¹ãƒ„ã‚¢ãƒ¼', 
    'ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ãƒ»éŠåœ’åœ°ä»˜ãã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ãƒ»éŠåœ’åœ°ä»˜', 
    'è¦³å…‰ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'è¦³å…‰ä»˜',
    'ç¥­ã‚Šãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ç¥­ã‚Šãƒ»ã‚¤ãƒ™ãƒ³ãƒˆä»˜', 
    'ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ„ã‚¢ãƒ¼ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ„ã‚¢ãƒ¼ã‚ã‚Š', 
    'ä½“é¨“ãƒ»ã‚«ãƒ«ãƒãƒ£ãƒ¼ä»˜ãã‹ã©ã†ã‹ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ä½“é¨“ãƒ»ã‚«ãƒ«ãƒãƒ£ãƒ¼ä»˜', 
    'å®¶æ—æ—…è¡Œã‹ã©ã†ã‹ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å®¶æ—æ—…è¡Œ', 
    'ä¸€äººæ—…ã‹ã©ã†ã‹ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã²ã¨ã‚Šæ—…', 
    'å‡ºå¼µãƒ»ãƒ“ã‚¸ãƒã‚¹ç›®çš„ã‹ã©ã†ã‹ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å‡ºå¼µãƒ»ãƒ“ã‚¸ãƒã‚¹',
    'ã‚†ã£ãŸã‚Šç›®ã«æ¥½ã—ã¿ãŸã„ã‹ã©ã†ã‹ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚†ã£ãŸã‚Šæ—…', 
    'å­¦ç”Ÿæ—…è¡Œã‹ã©ã†ã‹ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å­¦ç”Ÿæ—…è¡Œ', 
    'ã‚«ãƒƒãƒ—ãƒ«orå¤«å©¦ã§æ—…è¡Œã™ã‚‹ã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'ã‚«ãƒƒãƒ—ãƒ«ãƒ»ã”å¤«å©¦', 
    'æ–°å©šæ—…è¡Œã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'æ–°å©šæ—…è¡Œ', 
    'è¨˜å¿µæ—¥æ—…è¡Œã‹ã©ã†ã‹é¸æŠã—ã¦ãã ã•ã„>':'è¨˜å¿µæ—¥æ—…è¡Œ', 
    'ã‚¤ãƒ«ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚¤ãƒ«ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³', 
    'USJãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'USJ', 
    'ã‚¹ã‚¤ãƒ¼ãƒ„ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚¹ã‚¤ãƒ¼ãƒ„',
    'é£Ÿã¹æ”¾é¡Œãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'é£Ÿã¹æ”¾é¡Œ', 
    'ãƒˆãƒ¬ãƒƒã‚­ãƒ³ã‚°ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ãƒˆãƒ¬ãƒƒã‚­ãƒ³ã‚°', 
    'ãƒã‚¤ã‚­ãƒ³ã‚°ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ãƒã‚¤ã‚­ãƒ³ã‚°', 
    'ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒãƒƒãƒˆå·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒãƒƒãƒˆ', 
    'ç™»å±±ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ç™»å±±', 
    'å›½ç«‹å…¬åœ’ãƒ»å¤§è‡ªç„¶å·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å›½ç«‹å…¬åœ’ãƒ»å¤§è‡ªç„¶', 
    'çµ¶æ™¯ãƒ»ç§˜å¢ƒãƒ»å¤§è‡ªç„¶å·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'çµ¶æ™¯ãƒ»ç§˜å¢ƒãƒ»å¤§è‡ªç„¶',
    'å¤œæ™¯ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å¤œæ™¯', 
    'åŸå·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'åŸ', 
    'éºè·¡å·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'éºè·¡', 
    'ä¸–ç•Œéºç”£å·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ä¸–ç•Œéºç”£', 
    'ç¾åœ°ã‚¬ã‚¤ãƒ‰ãƒ»è¦³å…‰ã‚¿ã‚¯ã‚·ãƒ¼ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ç¾åœ°ã‚¬ã‚¤ãƒ‰ãƒ»è¦³å…‰ã‚¿ã‚¯ã‚·ãƒ¼', 
    'å¯ºç¤¾ãƒ»ä»é–£ãƒ»æ•™ä¼šå·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å¯ºç¤¾ãƒ»ä»é–£ãƒ»æ•™ä¼š', 
    'å‹•ç‰©åœ’ãƒ»æ°´æ—é¤¨å·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'å‹•ç‰©åœ’ãƒ»æ°´æ—é¤¨',
    'åšç‰©é¤¨ãƒ»ç¾è¡“é¤¨å·¡ã‚Šãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'åšç‰©é¤¨ãƒ»ç¾è¡“é¤¨', 
    'èŠ±ç«ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'èŠ±ç«', 
    'ã‚´ãƒ«ãƒ•ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚´ãƒ«ãƒ•', 
    'ã‚¹ã‚­ãƒ¼ãƒ»ã‚¹ãƒãƒœï¼ˆãƒªãƒ•ãƒˆåˆ¸ä»˜ãï¼‰ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚¹ã‚­ãƒ¼ãƒ»ã‚¹ãƒãƒœï¼ˆãƒªãƒ•ãƒˆåˆ¸ä»˜ãï¼‰', 
    'ã‚¹ãƒ‘ãƒ»ã‚¨ã‚¹ãƒ†ãƒ»ãƒãƒƒã‚µãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³ã®æœ‰ç„¡ã‚’é¸æŠã—ã¦ãã ã•ã„>':'ã‚¹ãƒ‘ãƒ»ã‚¨ã‚¹ãƒ†ãƒ»ãƒãƒƒã‚µãƒ¼ã‚¸'
}
selection = ['âœ–ï¸', 'â—‹']

def travel(request):
    if request.method == 'GET':
        return render(request, 'mlapps/travel.html', 
        {
            'questions_travel':questions_travel,
            'destination':sorted(LE_destination.classes_),
            'inn_type':sorted(list(LE_inn_type.classes_)),
            'inn_num':sorted(list(LE_inn_num.classes_)),
            'meal':sorted(list(LE_meal.classes_)),
            'selection':selection
        })
    else:
        try:
            df_try = pd.DataFrame(index=['own'])
            for key, question in questions_travel.items():
                df_try[question] = request.POST[key]

            df_try['ç›®çš„åœ°'] = LE_destination.transform(df_try['ç›®çš„åœ°'])
            df_try['å®¿æ³Šæ–½è¨­ã‚¿ã‚¤ãƒ—'] = LE_inn_type.transform(df_try['å®¿æ³Šæ–½è¨­ã‚¿ã‚¤ãƒ—'])
            df_try['é£Ÿäº‹'] = LE_meal.transform(df_try['é£Ÿäº‹'])
            df_try['å®¿æ³Šæ–½è¨­å—ã‘å…¥ã‚Œäººæ•°'] = LE_inn_num.transform(df_try['å®¿æ³Šæ–½è¨­å—ã‘å…¥ã‚Œäººæ•°'])
            df_try = df_try.astype('int')

            pred = model_lgb_travel.predict(df_try)

            return render(request, 'mlapps/travel.html', {'pred':'{0:.2f}'.format(float(pred))})
        except:
            return render(request, 'mlapps/travel.html', 
        {
            'questions_travel':questions_travel,
            'destination':sorted(list(LE_destination.classes_)),
            'inn_type':sorted(list(LE_inn_type.classes_)),
            'inn_num':sorted(list(LE_inn_num.classes_)),
            'meal':sorted(list(LE_meal.classes_)),
            'selection':selection,
            'attention':attention
        })

def travel_detail(request):
    return render(request, 'mlapps/travel_detail.html', {})